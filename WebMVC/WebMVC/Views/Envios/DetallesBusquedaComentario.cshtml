@model WebMVC.DTOs.Envio.EnvioDTO
@{
    ViewData["Title"] = "DetallesBusquedaComentario";
    var termino = ViewBag.Comentario as string ?? "";
}

@if (Model == null)
{
    <div class="alert alert-warning">No se encontró el envío.</div>
} 
else{
    <h1>Detalles Envio por Comentario</h1>
    <div>
        <dl class="row">
            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.Id)</dt>
            <dd class="col-sm-10">@Html.DisplayFor(model => model.Id)</dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.Tracking)</dt>
            <dd class="col-sm-10">@Html.DisplayFor(model => model.Tracking)</dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.EmailCliente)</dt>
            <dd class="col-sm-10">@Html.DisplayFor(model => model.EmailCliente)</dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.Peso)</dt>
            <dd class="col-sm-10">@Html.DisplayFor(model => model.Peso)</dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.EstadoEnvio)</dt>
            <dd class="col-sm-10">@Html.DisplayFor(model => model.EstadoEnvio)</dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.FechaRegistroEnvio)</dt>
            <dd class="col-sm-10">@Html.DisplayFor(model => model.FechaRegistroEnvio)</dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.TipoEnvio)</dt>
            <dd class="col-sm-10">@Html.DisplayFor(model => model.TipoEnvio)</dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.FechaEntrega)</dt>
            <dd class="col-sm-10">
                @if (Model.FechaEntrega != null)
                {
                    @Html.DisplayFor(m => m.FechaEntrega)
                }
                else
                {
                    <span class="text-muted">No entregado</span>
                }
            </dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.EnvioEficiente)</dt>
            <dd class="col-sm-10">@(Model.EnvioEficiente ? "Sí" : "No")</dd>
        </dl>
        @if (Model.Comentarios?.Any() == true)
        {
            <h4>Comentarios</h4>
            <ul id="comentarios-list" class="list-group">
                @foreach (var c in Model.Comentarios)
                {
                    <li class="list-group-item">
                        <small>@c.Fecha.ToString("dd/MM/yyyy HH:mm")</small><br />
                        <span class="comentario-text">@c.Comentario</span>
                    </li>
                }
            </ul>
        }
    </div>
}
@section Scripts {
    <script>
        document.querySelectorAll('.comentario-text').forEach(el => {
            const termino = '@termino';
            if (termino) {
                el.innerHTML = el.textContent.replace(
                    new RegExp(`(${termino})`, 'gi'),
                    '<mark>$1</mark>'
                );
            }
        });
    </script>
}
<div>
    <a asp-action="BuscarPorComentario">Volver a los resultados</a>
</div>